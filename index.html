<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Farmer Dice</title>
    
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ²</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation; /* Improves touch response */
        }

        /* 3D Dice Styling */
        .die-container {
            perspective: 1000px;
        }
        
        .die {
            transform-style: preserve-3d;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05), inset 0 -4px 0 rgba(0,0,0,0.1);
        }

        /* Animation Classes */
        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* Animal Colors */
        .bg-rabbit { background-color: #ffffff; color: #374151; border: 2px solid #e5e7eb; }
        .bg-sheep { background-color: #fef3c7; color: #92400e; border: 2px solid #fcd34d; }
        .bg-pig { background-color: #fce7f3; color: #9d174d; border: 2px solid #fbcfe8; }
        .bg-cow { background-color: #e0e7ff; color: #3730a3; border: 2px solid #c7d2fe; }
        .bg-horse { background-color: #ffedd5; color: #9a3412; border: 2px solid #fdba74; }
        .bg-wolf { background-color: #1f2937; color: #f3f4f6; border: 2px solid #374151; } /* Dark Grey */
        .bg-fox { background-color: #ea580c; color: #fff7ed; border: 2px solid #c2410c; } /* Orange */

        .history-item {
            animation: fadeIn 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(-10px);
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-between p-4 max-w-md mx-auto">

    <header class="w-full text-center pt-4 mb-4">
        <h1 class="text-3xl font-bold text-gray-800 tracking-tight">Super Farmer</h1>
        <p class="text-sm text-gray-500 mt-1">Dice Simulator</p>
    </header>

    <main class="flex-grow flex flex-col justify-center w-full gap-8 mb-8">
        
        <div class="die-container w-full flex flex-col items-center">
            <span class="text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider">Blue Die</span>
            <div id="die1" class="die w-32 h-32 flex flex-col items-center justify-center rounded-2xl bg-white text-6xl">
                <span>â“</span>
            </div>
            <div id="label1" class="mt-3 text-lg font-bold text-gray-700 h-6">Ready</div>
        </div>

        <div class="die-container w-full flex flex-col items-center">
            <span class="text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider">Red Die</span>
            <div id="die2" class="die w-32 h-32 flex flex-col items-center justify-center rounded-2xl bg-white text-6xl">
                <span>â“</span>
            </div>
            <div id="label2" class="mt-3 text-lg font-bold text-gray-700 h-6">Ready</div>
        </div>

    </main>

    <div class="w-full mb-6">
        <button id="rollBtn" class="w-full bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transform transition-all active:scale-95 text-xl flex items-center justify-center gap-2">
            <span>ğŸ²</span> ROLL DICE
        </button>
    </div>

    <div class="w-full bg-white rounded-xl shadow-sm p-4 mb-4 border border-gray-100">
        <h3 class="text-xs font-bold text-gray-400 uppercase mb-3 border-b pb-2">Recent Rolls</h3>
        <div id="historyLog" class="space-y-2">
            <div class="text-center text-gray-300 text-sm italic py-2">No rolls yet</div>
        </div>
    </div>

    <script>
        // --- 1. Data Configuration ---
        // Die 1: Rabbit x6, Sheep x2, Pig x1, Cow x1, Horse x1, Wolf x1
        const DIE_1_FACES = [
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'sheep',  icon: 'ğŸ‘', name: 'Sheep',  type: 'bg-sheep' },
            { id: 'sheep',  icon: 'ğŸ‘', name: 'Sheep',  type: 'bg-sheep' },
            { id: 'pig',    icon: 'ğŸ·', name: 'Pig',    type: 'bg-pig' },
            { id: 'cow',    icon: 'ğŸ®', name: 'Cow',    type: 'bg-cow' },
            { id: 'horse',  icon: 'ğŸ´', name: 'Horse',  type: 'bg-horse' },
            { id: 'wolf',   icon: 'ğŸº', name: 'Wolf',   type: 'bg-wolf' }
        ];

        // Die 2: Rabbit x6, Sheep x3, Pig x2, Fox x1
        const DIE_2_FACES = [
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'rabbit', icon: 'ğŸ°', name: 'Rabbit', type: 'bg-rabbit' },
            { id: 'sheep',  icon: 'ğŸ‘', name: 'Sheep',  type: 'bg-sheep' },
            { id: 'sheep',  icon: 'ğŸ‘', name: 'Sheep',  type: 'bg-sheep' },
            { id: 'sheep',  icon: 'ğŸ‘', name: 'Sheep',  type: 'bg-sheep' },
            { id: 'pig',    icon: 'ğŸ·', name: 'Pig',    type: 'bg-pig' },
            { id: 'pig',    icon: 'ğŸ·', name: 'Pig',    type: 'bg-pig' },
            { id: 'fox',    icon: 'ğŸ¦Š', name: 'Fox',    type: 'bg-fox' }
        ];

        // --- 2. State & DOM ---
        let history = [];
        const btn = document.getElementById('rollBtn');
        const die1El = document.getElementById('die1');
        const die2El = document.getElementById('die2');
        const label1 = document.getElementById('label1');
        const label2 = document.getElementById('label2');
        const historyContainer = document.getElementById('historyLog');

        // --- 3. Functions ---
        function getRandomFace(dieArray) {
            const randomIndex = Math.floor(Math.random() * dieArray.length);
            return dieArray[randomIndex];
        }

        function updateDieVisuals(element, label, faceData) {
            // Remove old color classes
            element.className = element.className.replace(/bg-\w+/g, '');
            // Add new specific color class + standard classes
            element.classList.add(faceData.type);
            
            // Update Content
            element.innerHTML = `<span>${faceData.icon}</span>`;
            label.textContent = faceData.name;
        }

        function addToHistory(result1, result2) {
            history.unshift({ r1: result1, r2: result2, time: new Date() });
            if (history.length > 5) history.pop();
            renderHistory();
        }

        function renderHistory() {
            historyContainer.innerHTML = history.map((h, i) => `
                <div class="history-item flex items-center justify-between bg-gray-50 p-2 rounded-lg border border-gray-100" style="animation-delay: ${i * 50}ms">
                    <span class="text-xs text-gray-400 font-mono">#${history.length - i}</span>
                    <div class="flex gap-4">
                        <span class="text-xl" title="${h.r1.name}">${h.r1.icon}</span>
                        <span class="text-xl" title="${h.r2.name}">${h.r2.icon}</span>
                    </div>
                </div>
            `).join('');
        }

        function handleRoll() {
            // Disable button
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');

            // Reset Animation
            die1El.classList.remove('shake');
            die2El.classList.remove('shake');
            void die1El.offsetWidth; // Trigger reflow
            die1El.classList.add('shake');
            die2El.classList.add('shake');

            // Play sound effect logic could go here

            setTimeout(() => {
                // Calculation
                const result1 = getRandomFace(DIE_1_FACES);
                const result2 = getRandomFace(DIE_2_FACES);

                // Update UI
                updateDieVisuals(die1El, label1, result1);
                updateDieVisuals(die2El, label2, result2);
                
                // Add to history
                addToHistory(result1, result2);

                // Re-enable button
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                die1El.classList.remove('shake');
                die2El.classList.remove('shake');
            }, 500);
        }

        // --- 4. Event Listeners ---
        btn.addEventListener('click', handleRoll);

        // --- 5. Single-File PWA Magic ---
        // This creates a dynamic manifest and service worker from Blob URLs
        // to satisfy the PWA requirements without needing separate files on the server.
        
        // 5a. Dynamic Manifest
        const manifestObj = {
            "name": "Super Farmer Dice",
            "short_name": "SuperFarmer",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#f3f4f6",
            "theme_color": "#10b981",
            "icons": [{
                "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ²</text></svg>",
                "sizes": "192x192",
                "type": "image/svg+xml"
            }]
        };
        const stringManifest = JSON.stringify(manifestObj);
        const blobManifest = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blobManifest);
        
        let link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);

        // 5b. Dynamic Service Worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'super-farmer-v1';
                // Cache Tailwind and the main page
                const urlsToCache = [
                    './',
                    'https://cdn.tailwindcss.com' 
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                        .then(cache => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                        .then(response => {
                            // Cache hit - return response
                            if (response) {
                                return response;
                            }
                            return fetch(event.request);
                        })
                    );
                });
            `;
            
            const blobSW = new Blob([swCode], {type: 'application/javascript'});
            const swURL = URL.createObjectURL(blobSW);

            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swURL)
                .then(reg => console.log('SW Registered', reg))
                .catch(err => console.log('SW Failed', err));
            });
        }
    </script>
</body>
</html>
