<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—É–ø–µ—Ä –§–µ—Ä–º–µ—Ä: –ê—Å–∏—Å—Ç–µ–Ω—Ç</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2e7d32">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --bg: #f1f8e9;
            --surface: #ffffff;
            --text: #1a1a1a;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 16px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Layout Grid */
        .container {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 { margin: 0; font-size: 1.5rem; color: var(--primary-dark); }
        p { margin: 4px 0 0; color: #666; font-size: 0.9rem; }

        /* Farm State Inputs */
        .farm-state {
            background: var(--surface);
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            text-align: center;
        }

        .animal-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .animal-input label { font-size: 1.5rem; margin-bottom: 4px; }
        
        .animal-input input {
            width: 100%;
            padding: 8px 0;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-dark);
            -moz-appearance: textfield;
        }
        .animal-input input:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* Dice Section */
        .dice-area {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 25px;
            perspective: 1000px;
        }

        .die {
            width: 100px;
            height: 100px;
            background: var(--surface);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 8px 0 #cfd8dc, 0 8px 10px rgba(0,0,0,0.2);
            transition: transform 0.1s;
            border: 2px solid #eceff1;
        }

        .die.blue { border-color: #90caf9; }
        .die.red { border-color: #ef9a9a; }
        
        .die span { display: block; }
        .die .label { font-size: 0.8rem; color: #555; font-weight: bold; margin-top: 4px; }

        /* Results & Calculations */
        .result-panel {
            background: var(--surface);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .growth-info { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        .danger-info { color: #d32f2f; font-weight: bold; }

        /* Controls */
        .btn-main {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 0 var(--primary-dark);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-main:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 var(--primary-dark);
        }

        .danger-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-danger {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Animations */
        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg) translateY(-5px); }
            50% { transform: rotate(5deg) translateY(5px); }
            75% { transform: rotate(-5deg) translateY(-5px); }
        }

        /* Media Queries for Landscape/Tablets */
        @media (min-width: 600px) {
            .dice-area { gap: 40px; }
            .die { width: 120px; height: 120px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–°—É–ø–µ—Ä –§–µ—Ä–º–µ—Ä</h1>
            <p>–ê—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</p>
        </header>

        <section class="farm-state">
            <p style="text-align:center; margin-bottom:10px; font-weight:bold; color:#555;">–¢–≤–æ—î —Å—Ç–∞–¥–æ (–≤–≤–µ–¥–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å):</p>
            <div class="farm-grid">
                <div class="animal-input"><label>üê∞</label><input type="tel" id="inp-rabbit" value="0" min="0"></div>
                <div class="animal-input"><label>üêë</label><input type="tel" id="inp-sheep" value="0" min="0"></div>
                <div class="animal-input"><label>üê∑</label><input type="tel" id="inp-pig" value="0" min="0"></div>
                <div class="animal-input"><label>üêÆ</label><input type="tel" id="inp-cow" value="0" min="0"></div>
                <div class="animal-input"><label>üê¥</label><input type="tel" id="inp-horse" value="0" min="0"></div>
            </div>
        </section>

        <section class="dice-area">
            <div id="die1" class="die blue">
                <span id="icon1">‚ùì</span>
                <span id="text1" class="label">–°—Ç–∞—Ä—Ç</span>
            </div>
            <div id="die2" class="die red">
                <span id="icon2">‚ùì</span>
                <span id="text2" class="label">–°—Ç–∞—Ä—Ç</span>
            </div>
        </section>

        <section class="result-panel" id="resultPanel">
            <span style="color:#aaa">–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É, —â–æ–± –∫–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫–∏</span>
        </section>

        <button id="rollBtn" class="btn-main">
            üé≤ –ö–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫–∏
        </button>

        <div class="danger-actions">
            <button class="btn-danger" onclick="handlePredator('wolf')">üê∫ –í–∏–ø–∞–≤ –í–æ–≤–∫?</button>
            <button class="btn-danger" onclick="handlePredator('fox')">ü¶ä –í–∏–ø–∞–ª–∞ –õ–∏—Å–∏—Ü—è?</button>
        </div>
    </div>

    <script>
        // --- Game Data ---
        const D1 = [
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, 
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, 
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'},
            {id:'sheep', icon:'üêë', name:'–í—ñ–≤—Ü—è'}, {id:'sheep', icon:'üêë', name:'–í—ñ–≤—Ü—è'},
            {id:'pig', icon:'üê∑', name:'–°–≤–∏–Ω—è'}, {id:'cow', icon:'üêÆ', name:'–ö–æ—Ä–æ–≤–∞'},
            {id:'horse', icon:'üê¥', name:'–ö—ñ–Ω—å'}, {id:'wolf', icon:'üê∫', name:'–í–æ–≤–∫'}
        ];
        
        const D2 = [
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, 
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, 
            {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'}, {id:'rabbit', icon:'üê∞', name:'–ó–∞—î—Ü—å'},
            {id:'sheep', icon:'üêë', name:'–í—ñ–≤—Ü—è'}, {id:'sheep', icon:'üêë', name:'–í—ñ–≤—Ü—è'},
            {id:'sheep', icon:'üêë', name:'–í—ñ–≤—Ü—è'}, {id:'pig', icon:'üê∑', name:'–°–≤–∏–Ω—è'},
            {id:'pig', icon:'üê∑', name:'–°–≤–∏–Ω—è'}, {id:'fox', icon:'ü¶ä', name:'–õ–∏—Å–∏—Ü—è'}
        ];

        // --- Audio Context (Synthesis) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playShakeSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            // White noise simulation via randomization effectively (simple blip here)
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playPredatorSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // --- Logic ---
        function getSecureRandom(arr) {
            const array = new Uint32Array(1);
            window.crypto.getRandomValues(array);
            return arr[array[0] % arr.length];
        }

        function getInputVal(id) {
            return parseInt(document.getElementById(`inp-${id}`).value) || 0;
        }

        function rollDice() {
            const btn = document.getElementById('rollBtn');
            const d1El = document.getElementById('die1');
            const d2El = document.getElementById('die2');
            const resPanel = document.getElementById('resultPanel');

            // Feedback
            playShakeSound();
            if (navigator.vibrate) navigator.vibrate(50);
            
            d1El.classList.add('shake');
            d2El.classList.add('shake');
            btn.disabled = true;

            setTimeout(() => {
                const r1 = getSecureRandom(D1);
                const r2 = getSecureRandom(D2);

                // Render Dice
                document.getElementById('icon1').innerText = r1.icon;
                document.getElementById('text1').innerText = r1.name;
                document.getElementById('icon2').innerText = r2.icon;
                document.getElementById('text2').innerText = r2.name;

                d1El.classList.remove('shake');
                d2El.classList.remove('shake');
                btn.disabled = false;

                calculateGrowth(r1, r2);

            }, 500);
        }

        function calculateGrowth(r1, r2) {
            const resPanel = document.getElementById('resultPanel');
            let messages = [];
            
            // Check predators first
            if (r1.id === 'wolf' || r2.id === 'fox') {
                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                playPredatorSound();
                resPanel.innerHTML = `<div class="danger-info">‚ö†Ô∏è –£–í–ê–ì–ê: –•–ò–ñ–ê–ö! <br>–ü–µ—Ä–µ–≤—ñ—Ä —Å–æ–±–∞–∫ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É —Å–∫–∏–¥–∞–Ω–Ω—è –∑–Ω–∏–∑—É.</div>`;
                return;
            }

            // Calculate pairs
            // Logic: (Current + Dice) / 2 = New Offspring
            let counts = {};
            [r1, r2].forEach(r => counts[r.id] = (counts[r.id] || 0) + 1);

            let changed = false;

            for (let animal of ['rabbit', 'sheep', 'pig', 'cow', 'horse']) {
                if (counts[animal] || (animal === r1.id || animal === r2.id)) {
                    let onDice = counts[animal] || 0;
                    let onFarm = getInputVal(animal);
                    let total = onDice + onFarm;
                    let newBorn = Math.floor(total / 2);

                    if (newBorn > 0) {
                        messages.push(`+${newBorn} ${getAnimalName(animal, newBorn)}`);
                        changed = true;
                    }
                }
            }

            if (changed) {
                resPanel.innerHTML = `<div class="growth-info">${messages.join('<br>')}</div>`;
            } else {
                resPanel.innerHTML = `<div style="color:#777">–ù–∞ –∂–∞–ª—å, –ø–∞—Ä–∞ –Ω–µ —Å–∫–ª–∞–ª–∞—Å—è.</div>`;
            }
        }

        function getAnimalName(id, count) {
            const names = {
                rabbit: ['–ó–∞—î—Ü—å', '–ó–∞–π—Ü—è', '–ó–∞–π—Ü—ñ–≤'],
                sheep: ['–í—ñ–≤—Ü—è', '–í—ñ–≤—Ü—ñ', '–û–≤–µ—Ü—å'],
                pig: ['–°–≤–∏–Ω—è', '–°–≤–∏–Ω—ñ', '–°–≤–∏–Ω–µ–π'],
                cow: ['–ö–æ—Ä–æ–≤–∞', '–ö–æ—Ä–æ–≤–∏', '–ö–æ—Ä—ñ–≤'],
                horse: ['–ö—ñ–Ω—å', '–ö–æ–Ω—ñ', '–ö–æ–Ω–µ–π']
            };
            // Very simple pluralization for demo
            return count === 1 ? names[id][0] : names[id][2];
        }

        function handlePredator(type) {
            if(!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –¶–µ —Å–∫–∏–Ω–µ —Ç–≤–∞—Ä–∏–Ω –∑–≥—ñ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª.')) return;
            
            if (type === 'wolf') {
                // Wolf eats everything except Horse (and small dog, but we assume dog logic is manual)
                document.getElementById('inp-rabbit').value = 0;
                document.getElementById('inp-sheep').value = 0;
                document.getElementById('inp-pig').value = 0;
                document.getElementById('inp-cow').value = 0;
                alert('–í–æ–≤–∫ –∑\'—ó–≤ —É—Å–µ, –∫—Ä—ñ–º –ö–æ–Ω—è (—è–∫—â–æ –±—É–≤).');
            } else if (type === 'fox') {
                // Fox eats rabbits only
                document.getElementById('inp-rabbit').value = 0;
                alert('–õ–∏—Å–∏—Ü—è –∑\'—ó–ª–∞ –≤—Å—ñ—Ö –∑–∞–π—Ü—ñ–≤.');
            }
            if (navigator.vibrate) navigator.vibrate(200);
        }

        document.getElementById('rollBtn').addEventListener('click', rollDice);
        
        // PWA Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('SW Registered'))
                .catch(e => console.error('SW Fail', e));
        }
    </script>
</body>
</html>
